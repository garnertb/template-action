name: 'Create Issue'
on:
  workflow_dispatch:
  issue_comment:
    types: [created]
jobs:
  create-issue:
    if: startsWith(github.event.comment.body, '/getRecentIssues')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v1
      - name: install dependencies
        run: |
          npm install
      - uses: octokit/request-action@v2.x
        id: open-issues
        with:
          route: /repos/:owner/:repo/issues?sort=updated&per_page=100&state=all
          owner: garnertb
          repo: handlebars-action
        env:
          GITHUB_TOKEN: ${{ secrets.token }} 
      
      - uses: ./
        id: issue-body
        with:
          issues: ${{ steps.open-issues.outputs.data }}
          template: |
            ## Open issues
            {{#each issues }}
            {{#withinAWeek this.updated_at}}
            - [ ] #{{this.number}}
            {{/withinAWeek}}
            {{/each }}
      
      - uses: octokit/request-action@v2.x
        id: open-issues
        with:
          route: /repos/{owner}/{repo}/issues/{issue_number}/comments
          owner: ${{ github.repository_owner }}
          repo: template-action
          issue_number: ${{ github.event.issue.number }}
          body: ${{ steps.issue-body.outputs.payload }}